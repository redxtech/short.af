<html>
	<head>
		<title>shawt af baby</title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<script src="https://cdn.tailwindcss.com?plugins=forms"></script>
		<style>
			.animate-spin {
				animation: spin 1s linear infinite;

				@keyframes spin {
					from {
						transform: rotate(0deg);
					}
					to {
						transform: rotate(360deg);
					}
				}
			}
		</style>
	</head>
	<body>
		<div class="mx-auto max-w-7xl p-4 sm:p-6 lg:p-8">
			<div class="mx-auto max-w-3xl">
				<h1 class="text-3xl font-bold">shawt.af</h1>
			</div>
		</div>
		<div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
			<div class="mx-auto max-w-3xl">
				<div class="mt-6 grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6">
					<div class="sm:col-span-6">
						<label for="from" class="block text-sm font-medium text-gray-700">shortcut</label>
						<div class="mt-1 flex rounded-md shadow-sm">
							<span class="inline-flex items-center rounded-l-md border border-r-0 border-gray-300 bg-gray-50 px-3 text-gray-500 sm:text-sm">shawt.af/</span>
							<input type="text" name="from" id="from" class="block w-full min-w-0 flex-1 rounded-none rounded-r-md border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
						</div>
					</div>
				</div>
				<div class="mt-6 grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6">
					<div class="sm:col-span-6">
						<label for="to" class="block text-sm font-medium text-gray-700">destination</label>
						<div class="mt-1 flex rounded-md shadow-sm">
							<input type="text" name="to" id="to" placeholder="https://example.com" class="block w-full min-w-0 flex-1 rounded-none rounded-r-md border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
						</div>
					</div>
				</div>
				<div class="mt-6 grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6">
					<div class="sm:col-span-6">
						<button type="submit" id="submit" class="inline-flex justify-center rounded-md border border-transparent bg-indigo-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
							<svg id="spinner" class="animate-spin hidden -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
								<circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
								<path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
							</svg>
							create shortcut
						</button>
					</div>
				</div>
				<div id="success-box" class="hidden rounded-md bg-green-50 p-4 my-6">
					<div class="flex">
						<div class="flex-1 md:flex md:justify-between">
							<p class="text-sm text-green-700">your shortened link has been created: <a id="success-url" href="#" target="_blank" class="font-bold underline">#</a></p>
						</div>
					</div>
				</div>
				<div id="failure-box" class="hidden rounded-md bg-red-50 p-4 my-6">
					<div class="flex">
						<div class="flex-1 md:flex md:justify-between">
							<p class="text-sm text-red-700">link creation failed: <span id="failure-span" class="font-bold">reason</span></p>
						</div>
					</div>
				</div>
			</div>
		</div>
		<script>
			document.addEventListener('DOMContentLoaded', () => {
				document.getElementById('submit').addEventListener('click', async () => {
					// get data from the page
					const from = document.getElementById('from').value
					const to = document.getElementById('to').value

					// get page elements for later use
					const spinner = document.getElementById('spinner')
					const successBox = document.getElementById('success-box')
					const failureBox = document.getElementById('failure-box')
					const link = document.getElementById('success-url')
					const error = document.getElementById('failure-span')

					// start the spinner and hide all showing boxes
					spinner.classList.toggle('hidden')
					successBox.classList.add('hidden')
					failureBox.classList.add('hidden')

					try {
						// call the shortening api
						const req = await fetch(`/shorten/${from}|${to}`)

						if (req.status === 201) {
							// fill out the link with the new link information
							link.href = '/' + from
							link.innerText = `${window.location.protocol}//${window.location.host}/${from}`

							// show the box
							successBox.classList.toggle('hidden')
						} else {
							// fill out the link with the new link information
							error.innerText = `${await req.text()} (${req.status})`

							// show the box
							failureBox.classList.toggle('hidden')
						}
					} catch (err) {
						error.innerText = err
						failureBox.classList.toggle('hidden')
					}

					// stop the spinner
					spinner.classList.toggle('hidden')
				})
			})
		</script>
	</body>
</html>
